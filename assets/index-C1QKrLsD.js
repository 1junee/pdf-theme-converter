(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const I of o.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&a(I)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";const S="",T="meta-llama/Llama-3.1-8B-Instruct";let l=null,r=1,c=1.5,f="dark",h="",m=localStorage.getItem("hfToken")||S,y=localStorage.getItem("hfModel")||T;const L={light:"none",dark:"invert(1) hue-rotate(180deg)",sepia:"sepia(0.8) brightness(0.95)",night:"invert(1) hue-rotate(180deg) brightness(0.85) sepia(0.2)",green:"invert(1) hue-rotate(90deg) brightness(0.9)"},E=document.getElementById("fileInput"),b=document.getElementById("uploadBtn"),M=document.getElementById("uploadZone"),O=document.getElementById("uploadScreen"),v=document.getElementById("pdfViewer"),$=document.getElementById("pdfControls"),B=document.getElementById("pdfCanvas"),p=document.getElementById("textLayer"),_=document.getElementById("pageContainer"),x=document.getElementById("pageInput"),j=document.getElementById("totalPages"),w=document.getElementById("zoomLevel"),D=document.getElementById("themeSelector"),i=document.getElementById("explainBtn"),P=document.getElementById("sidePanel"),F=document.getElementById("selectedTextDisplay"),u=document.getElementById("explanationBox"),d=document.getElementById("settingsModal"),k=document.getElementById("hfTokenInput"),C=document.getElementById("hfModelInput");k.value=m;C.value=y;b.onclick=()=>E.click();M.onclick=()=>E.click();E.onchange=async t=>{const e=t.target.files[0];if(e&&e.type==="application/pdf")try{const s=await e.arrayBuffer();l=await pdfjsLib.getDocument({data:s}).promise,r=1,j.textContent=l.numPages,x.max=l.numPages,O.classList.add("hidden"),v.classList.remove("hidden"),$.classList.remove("hidden"),g()}catch(s){console.error("PDF 로드 오류:",s),alert("PDF 로드 중 오류가 발생했습니다.")}};async function g(){if(!l)return;const t=await l.getPage(r),e=t.getViewport({scale:c});B.width=e.width,B.height=e.height;const s=B.getContext("2d");await t.render({canvasContext:s,viewport:e}).promise;const a=await t.getTextContent();p.innerHTML="",p.style.width=`${e.width}px`,p.style.height=`${e.height}px`,pdfjsLib.renderTextLayer({textContentSource:a,container:p,viewport:e,textDivs:[]}),x.value=r,_.style.filter=L[f]}document.getElementById("prevPage").onclick=()=>{r>1&&(r--,g())};document.getElementById("nextPage").onclick=()=>{r<l.numPages&&(r++,g())};x.onchange=()=>{const t=parseInt(x.value);t>=1&&t<=l.numPages&&(r=t,g())};document.getElementById("zoomOut").onclick=()=>{c>.5&&(c-=.25,w.textContent=`${Math.round(c*100)}%`,g())};document.getElementById("zoomIn").onclick=()=>{c<3&&(c+=.25,w.textContent=`${Math.round(c*100)}%`,g())};D.onclick=t=>{t.target.classList.contains("theme-chip")&&(f=t.target.dataset.theme,document.querySelectorAll(".theme-chip").forEach(e=>{e.classList.toggle("active",e.dataset.theme===f)}),_.style.filter=L[f])};v.onmouseup=()=>{const t=window.getSelection(),e=t.toString().trim();if(e.length>0){h=e;const a=t.getRangeAt(0).getBoundingClientRect();i.style.left=`${a.left+a.width/2}px`,i.style.top=`${a.top-10}px`,i.style.display="flex"}else i.style.display="none"};i.onclick=async()=>{if(h){if(!m){d.classList.add("open"),alert("Hugging Face 토큰을 설정해주세요.");return}i.style.display="none",P.classList.add("open"),F.textContent=h,u.innerHTML='<div class="loading"><span class="spinner">⏳</span> 해설 생성 중...</div>';try{const t=await fetch(`https://api-inference.huggingface.co/models/${y}`,{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:`<|begin_of_text|><|start_header_id|>system<|end_header_id|>
You are a helpful assistant that explains academic text in Korean. Explain clearly and simply.<|eot_id|><|start_header_id|>user<|end_header_id|>
다음 텍스트를 한국어로 쉽게 설명해주세요. 학술 논문의 일부일 수 있으니 전문 용어도 풀어서 설명해주세요.

"${h}"<|eot_id|><|start_header_id|>assistant<|end_header_id|>`,parameters:{max_new_tokens:1024,temperature:.7,return_full_text:!1}})});if(!t.ok){const s=await t.json();throw new Error(s.error||`HTTP ${t.status}`)}const e=await t.json();Array.isArray(e)&&e[0]?.generated_text?u.textContent=e[0].generated_text:e.generated_text?u.textContent=e.generated_text:u.textContent=JSON.stringify(e,null,2)}catch(t){console.error("HF API 오류:",t),u.textContent=`Hugging Face API 오류: ${t.message}

해결 방법:
1. 설정에서 HF 토큰 확인
2. 토큰 발급: https://huggingface.co/settings/tokens
3. 모델 접근 권한 확인 (Llama는 승인 필요)`}}};document.getElementById("closeSidePanel").onclick=()=>{P.classList.remove("open")};document.getElementById("settingsBtn").onclick=()=>{d.classList.add("open")};d.onclick=t=>{t.target===d&&d.classList.remove("open")};document.getElementById("saveSettingsBtn").onclick=()=>{m=k.value,y=C.value,localStorage.setItem("hfToken",m),localStorage.setItem("hfModel",y),d.classList.remove("open")};
