<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Theme Converter - ë…¼ë¬¸ ë‹¤í¬ëª¨ë“œ ë³€í™˜</title>
    <meta name="description" content="ë…¼ë¬¸ê³¼ ë¬¸ì„œë¥¼ ëˆˆì— í¸ì•ˆí•œ ë‹¤í¬ ëª¨ë“œ ë° ë‹¤ì–‘í•œ í…Œë§ˆë¡œ ë³€í™˜í•˜ì„¸ìš”">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header-icon {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1rem;
            color: #a0a0a0;
            font-family: 'JetBrains Mono', monospace;
        }

        .card {
            background: rgba(26, 26, 46, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .upload-zone {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.02);
        }

        .upload-zone:hover {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.05);
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            opacity: 0.5;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .theme-button {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .theme-button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .theme-button.selected {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2));
            border-color: #6366f1;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .theme-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 0.75rem;
        }

        .theme-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .theme-desc {
            font-size: 0.75rem;
            color: #808080;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .button {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button.download {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .progress-container {
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .page-preview {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .page-preview:hover {
            transform: scale(1.05);
        }

        .page-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        .page-label {
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.5);
            text-align: center;
            font-size: 0.875rem;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <h1>PDF Theme Converter</h1>
            </div>
            <p>ë…¼ë¬¸ì„ ëˆˆì— í¸ì•ˆí•œ í…Œë§ˆë¡œ ë³€í™˜í•˜ì„¸ìš”</p>
        </div>

        <!-- Upload Section -->
        <div class="card">
            <input type="file" id="fileInput" accept="application/pdf" style="display: none;">
            <div class="upload-zone" id="uploadZone">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                <h3 id="fileName">PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</h3>
                <p style="color: #808080; font-size: 0.9rem;">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
            </div>
        </div>

        <!-- Theme Selection -->
        <div class="card">
            <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem;">í…Œë§ˆ ì„ íƒ</h2>
            <div class="theme-grid" id="themeGrid">
                <!-- Themes will be inserted here -->
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="button-group">
            <button class="button" id="convertBtn" disabled>ë³€í™˜ ì‹œì‘</button>
            <button class="button download hidden" id="downloadBtn">ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <!-- Progress -->
        <div class="card hidden" id="progressCard">
            <div class="progress-container">
                <span>ì²˜ë¦¬ ì¤‘...</span>
                <span id="progressText">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Preview -->
        <div class="card hidden" id="previewCard">
            <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem;" id="previewTitle">ë¯¸ë¦¬ë³´ê¸°</h2>
            <div class="preview-grid" id="previewGrid"></div>
        </div>
    </div>

    <script>
        // Initialize PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // State
        let pdfFile = null;
        let selectedTheme = 'dark';
        let processedPages = [];

        // Theme definitions
        const themes = {
            dark: {
                name: 'Dark Mode',
                icon: 'ğŸŒ™',
                description: 'ëˆˆì— í¸ì•ˆí•œ ë‹¤í¬ ëª¨ë“œ',
                filter: invertColors
            },
            sepia: {
                name: 'Sepia',
                icon: 'â˜•',
                description: 'ë”°ëœ»í•œ ì„¸í”¼ì•„ í†¤',
                filter: applySepiaFilter
            },
            night: {
                name: 'Night Blue',
                icon: 'ğŸŒŠ',
                description: 'ë¸”ë£¨ë¼ì´íŠ¸ ê°ì†Œ',
                filter: applyNightFilter
            },
            green: {
                name: 'Eye Care',
                icon: 'ğŸŒ¿',
                description: 'ëˆˆ ê±´ê°• ê·¸ë¦° ëª¨ë“œ',
                filter: applyGreenFilter
            },
            contrast: {
                name: 'High Contrast',
                icon: 'âš¡',
                description: 'ê³ ëŒ€ë¹„ ëª¨ë“œ',
                filter: applyHighContrastFilter
            }
        };

        // Filter functions
        function invertColors(imageData) {
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 255 - data[i];
                data[i + 1] = 255 - data[i + 1];
                data[i + 2] = 255 - data[i + 2];
            }
            return imageData;
        }

        function applySepiaFilter(imageData) {
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                data[i] = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
                data[i + 1] = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
                data[i + 2] = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
            }
            return imageData;
        }

        function applyNightFilter(imageData) {
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 255 - data[i];
                data[i + 1] = 255 - data[i + 1];
                data[i + 2] = Math.max(0, (255 - data[i + 2]) * 0.6);
            }
            return imageData;
        }

        function applyGreenFilter(imageData) {
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                const inverted = 255 - avg;
                
                data[i] = inverted * 0.3;
                data[i + 1] = inverted * 1.2;
                data[i + 2] = inverted * 0.3;
            }
            return imageData;
        }

        function applyHighContrastFilter(imageData) {
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                const color = avg > 128 ? 0 : 255;
                
                data[i] = color;
                data[i + 1] = color;
                data[i + 2] = color;
            }
            return imageData;
        }

        // Initialize theme buttons
        function initThemes() {
            const themeGrid = document.getElementById('themeGrid');
            Object.entries(themes).forEach(([key, theme]) => {
                const button = document.createElement('div');
                button.className = 'theme-button' + (key === selectedTheme ? ' selected' : '');
                button.innerHTML = `
                    <div class="theme-icon" style="font-size: 32px;">${theme.icon}</div>
                    <div class="theme-name">${theme.name}</div>
                    <div class="theme-desc">${theme.description}</div>
                `;
                button.onclick = () => selectTheme(key);
                themeGrid.appendChild(button);
            });
        }

        function selectTheme(theme) {
            selectedTheme = theme;
            document.querySelectorAll('.theme-button').forEach((btn, index) => {
                const themeKey = Object.keys(themes)[index];
                btn.className = 'theme-button' + (themeKey === theme ? ' selected' : '');
            });
        }

        // File upload
        const fileInput = document.getElementById('fileInput');
        const uploadZone = document.getElementById('uploadZone');
        const fileName = document.getElementById('fileName');
        const convertBtn = document.getElementById('convertBtn');

        uploadZone.onclick = () => fileInput.click();

        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                pdfFile = file;
                fileName.textContent = file.name;
                convertBtn.disabled = false;
                processedPages = [];
                document.getElementById('downloadBtn').classList.add('hidden');
                document.getElementById('previewCard').classList.add('hidden');
            } else {
                alert('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        };

        // Process PDF
        convertBtn.onclick = async () => {
            if (!pdfFile) return;

            convertBtn.disabled = true;
            document.getElementById('progressCard').classList.remove('hidden');
            document.getElementById('previewCard').classList.add('hidden');
            processedPages = [];

            try {
                const arrayBuffer = await pdfFile.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                const numPages = pdf.numPages;

                for (let pageNum = 1; pageNum <= numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const viewport = page.getViewport({ scale: 2 });
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;

                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    const filteredData = themes[selectedTheme].filter(imageData);
                    context.putImageData(filteredData, 0, 0);

                    processedPages.push(canvas.toDataURL('image/png'));
                    
                    const progress = Math.round((pageNum / numPages) * 100);
                    document.getElementById('progressText').textContent = `${progress}%`;
                    document.getElementById('progressFill').style.width = `${progress}%`;
                }

                showPreview();
                document.getElementById('downloadBtn').classList.remove('hidden');
            } catch (error) {
                console.error('PDF ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                alert('PDF ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                convertBtn.disabled = false;
                document.getElementById('progressCard').classList.add('hidden');
            }
        };

        // Show preview
        function showPreview() {
            const previewCard = document.getElementById('previewCard');
            const previewGrid = document.getElementById('previewGrid');
            const previewTitle = document.getElementById('previewTitle');
            
            previewTitle.textContent = `ë¯¸ë¦¬ë³´ê¸° (${processedPages.length} í˜ì´ì§€)`;
            previewGrid.innerHTML = '';
            
            processedPages.forEach((page, index) => {
                const div = document.createElement('div');
                div.className = 'page-preview';
                div.innerHTML = `
                    <img src="${page}" alt="Page ${index + 1}">
                    <div class="page-label">Page ${index + 1}</div>
                `;
                previewGrid.appendChild(div);
            });
            
            previewCard.classList.remove('hidden');
        }

        // Download PDF
        document.getElementById('downloadBtn').onclick = async () => {
            if (processedPages.length === 0) return;

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'px',
                    format: 'a4'
                });

                for (let i = 0; i < processedPages.length; i++) {
                    if (i > 0) pdf.addPage();
                    
                    const img = new Image();
                    img.src = processedPages[i];
                    await new Promise((resolve) => {
                        img.onload = resolve;
                    });

                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();
                    const imgRatio = img.width / img.height;
                    const pageRatio = pageWidth / pageHeight;

                    let width, height;
                    if (imgRatio > pageRatio) {
                        width = pageWidth;
                        height = pageWidth / imgRatio;
                    } else {
                        height = pageHeight;
                        width = pageHeight * imgRatio;
                    }

                    pdf.addImage(processedPages[i], 'PNG', 0, 0, width, height);
                }

                pdf.save(`${pdfFile.name.replace('.pdf', '')}_${selectedTheme}.pdf`);
            } catch (error) {
                console.error('PDF ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                alert('PDF ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };

        // Initialize
        initThemes();
    </script>
</body>
</html>
